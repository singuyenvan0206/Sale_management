<Window x:Class="WpfApp1.InvoiceManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quản Lý Hóa Đơn" Height="700" Width="1100"
        WindowStartupLocation="CenterScreen"
        KeyDown="Window_KeyDown">
	<Grid Background="#F5F5F5">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- Header -->
		<Border Grid.Row="0" Background="#1CB5E0" Padding="16">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>
				<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
					<TextBlock Text="🧾 Invoice Management" FontSize="22" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="  " Foreground="White"/>
                </StackPanel>
				<StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
					<TextBlock Text="Customer:" Foreground="White" VerticalAlignment="Center"/>
					<ComboBox x:Name="CustomerComboBox" Width="260" DisplayMemberPath="Name" SelectedValuePath="Id" Margin="10,0,0,0"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Main Content -->
		<Grid Grid.Row="1" Margin="20" >
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Product selector -->
			<Border Grid.Row="0" Background="White" CornerRadius="12" Padding="12" Margin="0,0,0,12">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="2*"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="120"/>
						<ColumnDefinition Width="120"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<ComboBox x:Name="ProductComboBox" Grid.Column="0" Margin="0,0,10,0" IsEditable="True" StaysOpenOnEdit="True"
							DisplayMemberPath="Name" SelectedValuePath="Id" SelectionChanged="ProductComboBox_SelectionChanged"/>
					<TextBlock Grid.Column="1" Text="Qty:" VerticalAlignment="Center" Margin="0,0,6,0"/>
					<TextBox x:Name="QuantityTextBox" Grid.Column="2" Text="1"/>
					<TextBox x:Name="UnitPriceTextBox" Grid.Column="3"/>
					<Button x:Name="AddItemButton" Grid.Column="4" Content="Add Item" Width="110" Height="32" Background="#1CB5E0" Foreground="White" Click="AddItemButton_Click"/>
				</Grid>
			</Border>

			<!-- Items grid -->
			<DataGrid x:Name="InvoiceItemsDataGrid" Grid.Row="1" AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" Background="White" RowHeaderWidth="0">
				<DataGrid.Columns>
					<DataGridTextColumn Header="#" Binding="{Binding RowNumber}" Width="40" IsReadOnly="True"/>
					<DataGridTextColumn Header="Product" Binding="{Binding ProductName}" Width="*" IsReadOnly="True"/>
					<DataGridTextColumn Header="Unit Price" Binding="{Binding UnitPrice, StringFormat=F2}" Width="120" IsReadOnly="True"/>
					<DataGridTextColumn Header="Qty" Binding="{Binding Quantity}" Width="80" IsReadOnly="True"/>
					<DataGridTextColumn Header="Line Total" Binding="{Binding LineTotal, StringFormat=F2}" Width="140" IsReadOnly="True"/>
					<DataGridTemplateColumn Header="Actions" Width="180">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<StackPanel Orientation="Horizontal">
									<Button Content="+" Width="32" Margin="0,0,6,0" Click="IncreaseQtyButton_Click"/>
									<Button Content="-" Width="32" Margin="0,0,6,0" Click="DecreaseQtyButton_Click"/>
									<Button Content="Remove" Background="#FC5C7D" Foreground="White" Click="RemoveItemButton_Click"/>
								</StackPanel>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
				</DataGrid.Columns>
			</DataGrid>
		</Grid>

		<!-- Totals & actions -->
		<Border Grid.Row="2" Background="White" CornerRadius="12" Padding="16" Margin="20">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="500"/>
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
					<Button x:Name="ClearInvoiceButton" Content="Clear" Width="100" Height="36" Click="ClearInvoiceButton_Click"/>
				</StackPanel>
				<Grid Grid.Column="1">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="140"/>
					</Grid.ColumnDefinitions>
					<TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal:" HorizontalAlignment="Right" Margin="0,0,8,6"/>
					<TextBlock x:Name="SubtotalTextBlock" Grid.Row="0" Grid.Column="1" Text="0.00" HorizontalAlignment="Right"/>
					<StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,6,0,6">
						<TextBlock Text="Tax %:" VerticalAlignment="Center"/>
						<TextBox x:Name="TaxPercentTextBox" Width="60" Text="0" TextChanged="TotalsInput_TextChanged" Margin="8,0,0,0"/>
						<TextBlock Text="Tax:" VerticalAlignment="Center" Margin="8,0,0,0"/>
						<TextBlock x:Name="TaxAmountTextBlock" Text="0.00" Width="80" TextAlignment="Right" Margin="8,0,0,0"/>
					</StackPanel>
					<StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,6,0,6">
						<TextBlock Text="Discount:" VerticalAlignment="Center"/>
						<TextBox x:Name="DiscountTextBox" Width="100" Text="0" TextChanged="TotalsInput_TextChanged" Margin="8,0,0,0"/>
						<CheckBox x:Name="UsePercentDiscountCheckBox" Content="%" VerticalAlignment="Center" Margin="8,0,0,0" Checked="TotalsInput_Toggle" Unchecked="TotalsInput_Toggle"/>
						<TextBox x:Name="DiscountPercentTextBox" Width="60" Text="0" Margin="8,0,0,0" TextChanged="TotalsInput_TextChanged"/>
					</StackPanel>
					<TextBlock Grid.Row="3" Grid.Column="0" Text="Total:" HorizontalAlignment="Right" FontWeight="Bold" Margin="0,8,8,6"/>
					<TextBlock x:Name="TotalTextBlock" Grid.Row="3" Grid.Column="1" Text="0.00" HorizontalAlignment="Right" FontWeight="Bold"/>
					<StackPanel Grid.Row="4" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
						<TextBlock Text="Paid:" VerticalAlignment="Center"/>
						<TextBox x:Name="PaidTextBox" Width="37" Text="0" TextChanged="TotalsInput_TextChanged" Margin="8,10,0,0"/>
						<TextBlock Text="Change:" VerticalAlignment="Center" Margin="8,0,0,0"/>
						<TextBlock x:Name="ChangeTextBlock" Text="0.00" Width="50" TextAlignment="Right" Margin="8,10,0,0"/>
						<Button x:Name="PrintInvoiceButton" Content="🖨️ Print" Width="100" Height="36" Background="#FF9800" Foreground="White" Click="PrintInvoiceButton_Click" Margin="8,0,0,0"/>
						<Button x:Name="SaveInvoiceButton" Content="Save Invoice" Width="130" Height="36" Background="#4CAF50" Foreground="White" Click="SaveInvoiceButton_Click" Margin="8,0,0,0"/>
					</StackPanel>
				</Grid>
			</Grid>
		</Border>
	</Grid>
</Window>
